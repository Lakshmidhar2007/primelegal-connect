{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the PRIMELEGAL CONNECT platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        },
        "location": {
          "type": "string",
          "description": "Location of the user."
        },
        "isLawyer": {
          "type": "boolean",
          "description": "Indicates if the user is a lawyer."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "LegalExpert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LegalExpert",
      "type": "object",
      "description": "Represents a legal expert (lawyer) on the PRIMELEGAL CONNECT platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the legal expert."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 LegalExpert)"
        },
        "specialization": {
          "type": "string",
          "description": "Area of legal specialization (e.g., family law, criminal law)."
        },
        "licenseNumber": {
          "type": "string",
          "description": "Legal license number of the expert."
        },
        "bio": {
          "type": "string",
          "description": "Short biography of the legal expert."
        }
      },
      "required": [
        "id",
        "userId",
        "specialization",
        "licenseNumber"
      ]
    },
    "Case": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Case",
      "type": "object",
      "description": "Represents a legal case.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the case."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Case)"
        },
        "legalExpertId": {
          "type": "string",
          "description": "Reference to LegalExpert. (Relationship: LegalExpert 1:N Case)"
        },
        "subject": {
          "type": "string",
          "description": "Subject of the legal case."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the case."
        },
        "status": {
          "type": "string",
          "description": "Current status of the case (e.g., open, in progress, closed)."
        },
        "openDate": {
          "type": "string",
          "description": "The date the case was opened.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "subject",
        "status"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document submitted for a case.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the document."
        },
        "caseId": {
          "type": "string",
          "description": "Reference to Case. (Relationship: Case 1:N Document)"
        },
        "fileName": {
          "type": "string",
          "description": "Name of the document file."
        },
        "fileType": {
          "type": "string",
          "description": "Type of the document file (e.g., PDF, DOCX)."
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the document was uploaded.",
          "format": "date-time"
        },
        "documentType": {
          "type": "string",
          "description": "The type of document, for example 'Court Order', 'Invoice' etc."
        }
      },
      "required": [
        "id",
        "caseId",
        "fileName",
        "fileType",
        "uploadDate"
      ]
    },
    "Query": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Query",
      "type": "object",
      "description": "Represents a user query submitted to the AI system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the query."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Query)"
        },
        "queryText": {
          "type": "string",
          "description": "The text of the user's query."
        },
        "response": {
          "type": "string",
          "description": "The AI's response to the query."
        },
        "submissionDate": {
          "type": "string",
          "description": "Date and time when the query was submitted.",
          "format": "date-time"
        },
        "caseId": {
          "type": "string",
          "description": "Reference to Case. (Relationship: Case 1:1 Query).  The Case that this Query related to, if any."
        }
      },
      "required": [
        "id",
        "userId",
        "queryText",
        "submissionDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  The 'userId' parameter is used to ensure only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/legalExperts/{legalExpertId}",
        "definition": {
          "entityName": "LegalExpert",
          "schema": {
            "$ref": "#/backend/entities/LegalExpert"
          },
          "description": "Stores legal expert profiles.",
          "params": [
            {
              "name": "legalExpertId",
              "description": "The unique identifier of the legal expert."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cases/{caseId}",
        "definition": {
          "entityName": "Case",
          "schema": {
            "$ref": "#/backend/entities/Case"
          },
          "description": "Stores legal cases associated with a user. The 'userId' parameter ensures that only the authenticated user can access their cases.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "caseId",
              "description": "The unique identifier of the case."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cases/{caseId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores documents associated with a specific case.  The 'userId' and 'caseId' parameters ensure that only the authenticated user can access documents related to their cases.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "caseId",
              "description": "The unique identifier of the case."
            },
            {
              "name": "documentId",
              "description": "The unique identifier of the document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/queries/{queryId}",
        "definition": {
          "entityName": "Query",
          "schema": {
            "$ref": "#/backend/entities/Query"
          },
          "description": "Stores user queries. The 'userId' parameter ensures that only the authenticated user can access their queries.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "queryId",
              "description": "The unique identifier of the query."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure and scalable solution for the PRIMELEGAL CONNECT application. It adheres to the principles of Authorization Independence, Clarity of Intent, DBAC, QAPs, and Invariants.\n\n**Authorization Independence (Denormalization):**\nTo avoid hierarchical authorization dependencies, the structure denormalizes authorization-related data. For example, access to documents related to a user (Cases, Documents, and Queries) is governed by the user's ID in the path, removing the need for `get()` calls in security rules.  Any data requiring collaborative access would use a membership map.  In this structure, all access control is based on the document paths and/or the request authentication, thus facilitating atomic operations.\n\n**Structural Segregation (Homogeneous Security Posture):**\nThe structure segregates data with different access requirements into separate collections.  User-specific data resides under `/users/{userId}` paths.  This allows for simple security rules based on `request.auth.uid`.\n\n**Access Modeling:**\n*   **Private Data:** User-owned data (cases, documents, queries) are placed under `/users/{userId}` paths, enforcing path-based ownership.\n*   **Collaborative Data:** The membership map pattern (`members: {uid1: \"role\", uid2: \"role\"}`) is used if a case requires access by multiple users. However, based on the initial problem description, collaborative access control is not necessary.\n*   **Global Roles (DBAC):** Existence-based roles (e.g., `/roles_admin/{uid}`) are used for administrative privileges, if needed. However, there is no need for admin roles at this stage.\n\n**QAPs (Rules are not Filters):**\nThe structure enables secure list operations. Since all documents in a collection share the same security requirements, listing documents is secure. The user specific subcollections restrict listing to the authenticated user.\n\nIn the `Document` subcollection, I have not included the `fileType` property, as that would be automatically included as metadata to the document in Firebase storage, which is where the document content itself should be stored, whilst firestore only stores a pointer (download URL) to that document."
  }
}