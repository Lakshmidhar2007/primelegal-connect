{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account within the PRIMELEGAL CONNECT application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user account.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "isLawyer": {
          "type": "boolean",
          "description": "Indicates whether the user is a lawyer or not."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time the user registered.",
          "format": "date-time"
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "specialty": {
            "type": "string",
            "description": "The lawyer's primary area of legal practice."
        },
        "bio": {
            "type": "string",
            "description": "A professional biography for the lawyer."
        },
        "website": {
            "type": "string",
            "format": "uri",
            "description": "The lawyer's professional website."
        },
        "linkedin": {
            "type": "string",
            "format": "uri",
            "description": "A link to the lawyer's LinkedIn profile."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "isLawyer",
        "registrationDate"
      ]
    },
    "PublicLawyerProfile": {
      "title": "Public Lawyer Profile",
      "type": "object",
      "description": "Represents the publicly visible information for a lawyer.",
      "properties": {
          "firstName": {
              "type": "string"
          },
          "lastName": {
              "type": "string"
          },
          "photoURL": {
              "type": "string",
              "format": "uri"
          },
          "specialty": {
              "type": "string"
          }
      },
      "required": ["firstName", "lastName"]
    },
    "Case": {
      "title": "Case",
      "type": "object",
      "description": "Represents a legal case submitted by a user.",
      "properties": {
        "caseSubject": {
          "type": "string",
          "description": "The subject line of the case."
        },
        "documentType": {
          "type": "string",
          "description": "The primary type of document associated with the case."
        },
        "fileName": {
          "type": "string",
          "description": "The name of the uploaded file."
        },
        "notes": {
          "type": "string",
          "description": "Detailed notes or description of the case."
        },
        "submitted": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the case was submitted."
        },
        "status": {
          "type": "string",
          "description": "The current status of the case.",
          "enum": [
            "Submitted",
            "In Review",
            "Expert Assigned",
            "Resolved",
            "Documents Submitted",
            "Initial Filing"
          ]
        }
      },
      "required": ["caseSubject", "documentType", "submitted", "status"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Uses path-based ownership for access control, ensuring only the user can access their data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  This is also the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/lawyers/{lawyerId}",
        "definition": {
            "entityName": "PublicLawyerProfile",
            "schema": { "$ref": "#/backend/entities/PublicLawyerProfile" },
            "description": "Stores public-facing information for lawyers. This collection is readable by any authenticated user. Security rules MUST allow authenticated read.",
            "params": [
                {
                    "name": "lawyerId",
                    "description": "The unique identifier for the lawyer, which matches their Firebase Auth UID."
                }
            ]
        }
      },
      {
        "path": "/users/{userId}/cases/{caseId}",
        "definition": {
          "entityName": "Case",
          "schema": {
            "$ref": "#/backend/entities/Case"
          },
          "description": "Stores the cases submitted by a specific user. Access is controlled by user ownership.",
          "params": [
             {
              "name": "userId",
              "description": "The unique identifier for the user who owns the case."
            },
            {
              "name": "caseId",
              "description": "The unique identifier for the case."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support user authentication, account management, and user-specific case submissions. It leverages path-based ownership for user accounts and their associated cases to ensure data privacy and security. The `/lawyers` collection is intentionally public to authenticated users to allow for browsing. This approach simplifies security rules, allowing direct enforcement of access control based on the user's ID. This design prioritizes Authorization Independence, eliminating the need for `get()` calls in security rules, enabling atomic operations. The structure avoids mixing data with different access needs within the same collections (Structural Segregation). Security rules have been updated to allow authenticated users to list lawyers and manage their own cases."
  }
}
